<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.ssafit.model.dao.UserDao">
	<resultMap type="user" id="userMap">
		<id column="id" property="id" />
		<result column="image_id" property="imageId" />
		<result column="login_id" property="loginId" />
		<result column="login_pw" property="loginPw" />
		<result column="nickname" property="nickname" />
		<result column="email" property="email" />
		<result column="gender" property="gender" />
		<result column="age" property="age" />
		<result column="role" property="role" />
		<result column="created_at" property="createdAt" />
	</resultMap>

	<insert id="insertUser" parameterType="java.util.HashMap">
		INSERT INTO user
		(`image_id`, `login_id`, `login_pw`, `nickname`, `email`, `gender`,`age`, `role`)
		VALUES
		(#{imageId}, #{loginId}, #{loginPw}, #{nickname}, #{email}, #{gender}, #{age}, #{role})
		<selectKey resultType="int" keyProperty="id" order="AFTER">
        	SELECT LAST_INSERT_ID()
    	</selectKey>
	</insert>
		
	<update id="updateUser" parameterType="user"> 
		UPDATE user SET 
		image_id = #{imageId}, login_pw = #{loginPw}, nickname = #{nickname}, 
		email = #{email}, gender = #{gender}, age = #{age}, role = #{role}
		WHERE id = #{id} 
	</update> 
	
	<select id="selectByLoginId" resultMap="userMap" parameterType="string"> 
		SELECT * FROM user WHERE login_id = #{loginId} 
	</select>

	<delete id="deleteUser" parameterType="int"> 
		DELETE FROM user WHERE id = #{id} 
	</delete>

	<select id="selectById" resultMap="userMap" parameterType="int">
		SELECT * FROM user WHERE id = #{id}
	</select>
	
	<select id="selectListbyIdo" resultMap="userMap" parameterType="int">
  		SELECT * FROM user WHERE user.id in (SELECT follow_id
            								FROM relationship
            								WHERE user_id = #{id})
  	</select> 

  	<select id="selectListbyTheydo" resultMap="userMap" parameterType="int">
  		SELECT * FROM user WHERE user.id in (SELECT user_id
            								FROM relationship
            								WHERE follow_id = #{id})
  	</select> 
</mapper>

